<% include ./header.ejs %>

<!-- Page Content -->
<div class="container">

        <!-- Page Heading -->
        <h1 class="my-4">All Events
          <small>See, Create, Participate</small>
        </h1>
        
            <div class="row">
                <div class="col btn-group" role="group" aria-label="Basic example">
                    <button id="callapseButton1" type="button" class="btn btn-light active">Current Events</button>
                    <button id="callapseButton2" type="button" class="btn btn-light">Finished Events</button>
                    <button id="callapseButton3" type="button" class="btn btn-light">Create Event</button>
                </div>
            </div></br>
      
        <div class="row collapse show collapseExample1">
            <% var i = 0; currentEvents.forEach(function(event) { i++; %>
              <div class="col-lg-6 mb-4">
                  <div class="card h-100">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Event Number:
                        <span><b><%=event.event_id%></b></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Status:
                        <span><b><%=event.status%></b></span>
                    </li>
                    <div class="card-body">
                      <% if(event.status == 'new'){ %>
                        <% var a = 0; event.players.forEach(function(player) { a++; %>
                          <% if(event.owner == player._id){ %>
                            <a href="#" class="badge badge-success"><%=player.username%></a>
                          <% } else{ %>  
                            <a href="#" class="badge badge-primary"><%=player.username%></a>
                         <% } %>
                        <% }); %>
                      <% } %>
                      <% if(event.status == 'started'){ %>
                        <div class="row">
                            <div class="col-6">Team 1: 
                                <% event.players.forEach(function(player) {%>
                                  <a href="#">
                                    <span class="badge badge-primary badge-pill"><%=player.username%></span>
                                  </a>
                                <% }); %>
                            </div>
                            <div class="col-6">Team 2: 
                                <% event.players.forEach(function(player) {%>
                                  <a href="#">
                                    <span class="badge badge-primary badge-pill"><%=player.username%></span>
                                  </a>
                                <% }); %>
                            </div>
                        </div>
                      <% } %>
                    </div>
                    <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Number Of Players
                              <span class="badge badge-primary badge-pill"><%=event.players.length%></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Place:
                              <span><%=event.place%></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Date and Time:
                              <span><%=event.date%> <%=event.time%></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <% if (owner != event.owner && event.status == 'new'){{%>
                                  <button id="attendButton" onclick="attendEvent('<%= event._id %>')" class="btn btn-outline-primary">Attend</button>
                                <% }} %>
                                <% if (owner == event.owner || admin){{%>
                                  <% if (event.status == 'new'){{%>
                                  <button onclick="generateTeams('<%=event._id%>')" class="btn btn-outline-success">Generate Teams</button>
                                  <% }} %>
                                  <% if (event.status == 'started'){{%>
                                  <button id="finishEventButton" class="btn btn-outline-secondary" data-toggle="modal" data-target="#finishEventModal">Finish Event</button>
                                  <% }} %>
                                  <button onclick="submitCancelEvent('<%=event._id%>')" class="btn btn-outline-danger">Cancel Event</button>
                                <% }} %>
                            </li>
                    </ul>
                  </div>
              </div>
            <% }); %>
        </div>

        <div class="row collapse collapseExample2">
            <% var i = 0; finishedEvents.forEach(function(event) { i++; %>
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-body">                  
                        <% event.players.forEach(function(player) {%>
                        <a href="#">
                          <span class="badge badge-primary badge-pill"><%=player.username%></span>
                        </a>
                        <% }); %>
                    </div>
                    <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Number Of Players
                              <span class="badge badge-primary badge-pill"><%=event.players.length%></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Place:
                              <span><%=event.place%></span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                              Date and Time:
                              <span><%=event.date%></span>
                            </li>
                    </ul>
                </div>
              </div>
            <% }); %>
        </div>

        <div class="collapse collapseExample3">
                                <form id="createEventForm">
                                        <div class="form-group">
                                            <label>Place</label>
                                            <input type="text" name="place" class="form-control" placeholder="1234 Main St">
                                        </div>
                                        <div class="form-row">
                                          <div class="form-group col-md-6">
                                            <label>Date</label>
                                            <input type="date" name="date" min="2019-01-01" max="2099-01-01" class="form-control">
                                          </div>
                                          <div class="form-group col-md-6">
                                            <label>Time</label>
                                            <input type="time" name="time" class="form-control">
                                          </div>
                                        </div>

                                        <div class="form-group">
                                            <label>Destription (Optional)</label>
                                            <textarea class="form-control" name="description" rows="3"></textarea>
                                        </div>

                                        <div class="form-group">
                                          <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="gridCheck">
                                            <label class="form-check-label" for="gridCheck">
                                              Confirm
                                            </label>
                                          </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Create</button>
                                    </form>
        </div>      
</div>
<!-- /.container -->
  
  <!-- Modal -->
  <div class="modal fade" id="finishEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">What was the game score?</h5>
        </div>
        <div class="modal-body">
            <div class="form-group col-md-6">
                <label>Team 1</label>
                <input type="number" name="team1" class="form-control">
              </div>
              <div class="form-group col-md-6">
                  <label>Team 2</label>
                  <input type="number" name="team2" class="form-control">
                </div>        
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button onclick="submitFinishEvent()" type="button" class="btn btn-primary" data-dismiss="modal">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal 
  <div class="modal fade" id="cancelEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Are you sure you want to cancel this event?</h5>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button onclick="submitCancelEvent()" type="button" class="btn btn-primary" data-dismiss="modal">Submit</button>
          </div>
        </div>
      </div>
    </div>-->

  <!-- Dialog -->
  <div class="col-lg-6 mb-4" id="dialog">
  </div>

</body>
<script type="text/javascript" src="/javascripts/eventsView.js"></script>

<!-- Footer -->
<footer class="page-footer font-small cyan darken-3">
    <!-- Copyright -->
    <div class="footer-copyright text-center py-3">© 2019 Made by Rastafactory
    </div>
</footer>
<!-- Footer -->

</html>
