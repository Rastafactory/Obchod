<% include ./header.ejs %>

<!-- Page Content -->
<div class="container">

  <!-- Page Heading -->
  <h1 class="my-4">All Events
    <small>See, Create, Participate</small>
  </h1>

  <div class="row">
    <div class="col btn-group" role="group" aria-label="Basic example">
      <button id="callapseButton1" type="button" class="btn btn-light active" data-toggle="tooltip" data-placement="top"
        title="Here you can see the list of the events which are going to be played. If you would like to join, just click on Attend button.">Current
        Events</button>
      <button id="callapseButton2" type="button" class="btn btn-light" data-toggle="tooltip" data-placement="top"
        title="Here you can see the list of finished events and their details. Don't forget to assign your goals and assists.">Finished
        Events</button>
      <button id="callapseButton3" type="button" class="btn btn-light" data-toggle="tooltip" data-placement="top"
        title="Everybody can create an event. You will become an event owner after you create it.">Create Event</button>
    </div>
  </div></br>

  <div class="row collapse show collapseExample1">
    <% var i = 0; currentEvents.forEach(function(event) { i++; %>
    <div class="col-lg-6 mb-4">
      <div class="card h-100">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Event Number:
          <span><b><%=event.event_id%></b></span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Status:
          <span><b><%=event.status%></b></span>
        </li>
        <div class="card-body">
          <% if(event.status == 'new'){ %>
          <% var a = 0; event.players.forEach(function(player) { a++; %>
          <% if(event.owner == player._id){ %>
          <a href="#" class="badge badge-success"><%=player.username%></a>
          <% } else{ %>
          <a href="#" class="badge badge-primary"><%=player.username%></a>
          <% } %>
          <% }); %>
          <% } %>
          <% if(event.status == 'started'){ %>
          <div class="row">
            <div class="col-6">Team 1:
              <% event.team1.players.forEach(function(player) {%>
              <% if(event.owner == player._id){ %>
              <a href="#" class="badge badge-success"><%=player.username%></a>
              <% } else{ %>
              <a href="#" class="badge badge-primary"><%=player.username%></a>
              <% } %>
              <% }); %>
            </div>
            <div class="col-6">Team 2:
              <% event.team2.players.forEach(function(player) {%>
              <% if(event.owner == player._id){ %>
              <a href="#" class="badge badge-success"><%=player.username%></a>
              <% } else{ %>
              <a href="#" class="badge badge-primary"><%=player.username%></a>
              <% } %>
              <% }); %>
            </div>
          </div>
          <% } %>
        </div>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Number Of Players
            <span class="badge badge-primary badge-pill"><%=event.players.length%></span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Place:
            <span><%=event.place%></span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Date and Time:
            <span><%=event.date%> <%=event.time%></span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <% if (loggedUser._id != event.owner && event.status == 'new'){{%>
            <button id="attendButton" onclick="attendEvent('<%= event._id %>')"
              class="btn btn-outline-primary">Attend</button>
            <% }} %>
            <% if (loggedUser._id == event.owner || admin){{%>
            <% if (event.status == 'new'){{%>
            <button onclick="generateTeams('<%=event._id%>')" class="btn btn-outline-success">Generate Teams</button>
            <% }} %>
            <% if (event.status == 'started'){{%>
            <button onclick="submitFinishEvent('<%=event._id%>')" class="btn btn-outline-secondary">Finish
              Event</button>
            <% }} %>
            <button onclick="submitCancelEvent('<%=event._id%>')" class="btn btn-outline-danger">Cancel Event</button>
            <% }} %>
          </li>
        </ul>
      </div>
    </div>
    <% }); %>
  </div>

  <div class="row collapse collapseExample2">
    <% var i = 0; finishedEvents.forEach(function(event) { i++; %>
    <div class="col-lg-6 mb-4">
      <div class="card h-100">
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Event Number:
          <span><b><%=event.event_id%></b></span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Status:
          <span><b><%=event.status%></b></span>
        </li>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Result:
          <% if(event.team1.goals > event.team2.goals){ %>
          <span><b><%=event.team1.goals%> : </b><%=event.team2.goals%></span>
          <% } %>
          <% if(event.team2.goals > event.team1.goals){ %>
          <span><%=event.team1.goals%> : <b><%=event.team2.goals%></b></span>
          <% } %>
          <% if(event.team1.goals == event.team2.goals){ %>
          <span><%=event.team1.goals%> : <%=event.team2.goals%></span>
          <% } %>
        </li>
        <div class="card-body">
          <div class="row">
            <div class="col-6">Team 1:
              <% event.team1.players.forEach(function(player) {%>
              <% if(event.owner == player._id){ %>
              <a href="#" class="badge badge-success"><%=player.username%></a>
              <% } else{ %>
              <a href="#" class="badge badge-primary"><%=player.username%></a>
              <% } %>
              <% }); %>
            </div>
            <div class="col-6">Team 2:
              <% event.team2.players.forEach(function(player) {%>
              <% if(event.owner == player._id){ %>
              <a href="#" class="badge badge-success"><%=player.username%></a>
              <% } else{ %>
              <a href="#" class="badge badge-primary"><%=player.username%></a>
              <% } %>
              <% }); %>
            </div>
          </div>
        </div>
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Place:
            <span><%=event.place%></span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Date and Time:
            <span><%=event.date%> <%=event.time%></span>
          </li>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <button id="attendButton" onclick="location.href='/events/finishedEvent/<%=event._id%>';"
              class="btn btn-outline-primary">Detail</button>
          </li>
        </ul>
      </div>
    </div>
    <% }); %>
  </div>

  <div class="collapse collapseExample3">
    <form id="createEventForm">
      <div class="form-group">
        <label>Place</label>
        <input type="text" name="place" class="form-control" placeholder="1234 Main St">
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label>Date</label>
          <input type="date" name="date" min="2019-01-01" max="2099-01-01" class="form-control">
        </div>
        <div class="form-group col-md-6">
          <label>Time</label>
          <input type="time" name="time" class="form-control">
        </div>
      </div>

      <div class="form-group">
        <label>Destription (Optional)</label>
        <textarea class="form-control" name="description" rows="3"></textarea>
      </div>

      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="gridCheck">
          <label class="form-check-label" for="gridCheck">
            Confirm
          </label>
        </div>
      </div>
      <button type="submit" class="btn btn-primary">Create</button>
    </form>
  </div>
</div>
<!-- /.container -->

<!-- Dialog -->
<div id="cancelEventDialog">
</div>

<div id="finishEventDialog">
</div>

</body>
<script type="text/javascript" src="/javascripts/eventsView.js"></script>

<!-- Footer -->
<footer class="page-footer font-small cyan darken-3">
  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">Â© 2019 Made by Rastafactory
  </div>
</footer>
<!-- Footer -->

</html>